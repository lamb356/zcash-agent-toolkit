<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zcash Agent Toolkit Demo</title>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }

    :root {
      --bg: #07080d;
      --panel: #12131b;
      --line: #24263a;
      --text: #e6e7f1;
      --muted: #7f87a3;
      --blue: #60a5fa;
      --purple: #a855f7;
      --green: #34d399;
      --mono: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      --sans: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, sans-serif;
    }

    body {
      margin: 0;
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    header {
      padding: 1rem;
      border-bottom: 1px solid var(--line);
      text-align: center;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr 320px 1fr;
      min-height: calc(100vh - 90px);
      gap: 0;
    }

    .panel {
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .agent-header {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-weight: 700;
    }

    .agent-alpha .agent-header { color: var(--blue); }
    .agent-beta .agent-header { color: var(--purple); }

    .agent-card {
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 0.6rem;
      background: var(--panel);
      min-height: 95px;
    }

    .label {
      color: var(--muted);
      font-size: 0.75rem;
      margin-bottom: 0.25rem;
    }

    .value {
      font-family: var(--mono);
      font-size: 0.72rem;
      word-break: break-all;
      line-height: 1.3;
      color: #f1f5f9;
      min-height: 1.2rem;
    }

    .status {
      font-size: 0.75rem;
      color: var(--muted);
      min-height: 1rem;
    }

    .chain {
      border-left: 1px solid var(--line);
      border-right: 1px solid var(--line);
      background:
        radial-gradient(circle at 20% 20%, rgba(96,165,250,.12), transparent 28%),
        radial-gradient(circle at 80% 80%, rgba(168,85,247,.12), transparent 28%),
        var(--panel);
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.65rem;
      overflow: auto;
    }

    .chain h3 {
      margin: 0;
      font-size: 0.8rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      text-align: center;
    }

    .memo {
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 0.55rem;
      font-size: 0.72rem;
      background: rgba(10, 11, 20, 0.9);
      animation: fade 0.35s ease both;
    }

    .memo .kind { font-weight: 600; margin-bottom: 0.25rem; }
    .memo .from { font-size: 0.68rem; color: var(--muted); }
    .memo .details { color: #dbeafe; font-size: 0.66rem; margin-top: 0.22rem; word-break: break-all; }

    .alpha { color: var(--blue); }
    .beta { color: var(--purple); }

    .log {
      border: 1px solid var(--line);
      border-radius: 8px;
      background: var(--panel);
      padding: 0.5rem;
      flex: 1;
      overflow: auto;
      min-height: 160px;
    }

    .log p {
      font-size: 0.73rem;
      margin: 0 0 0.45rem 0;
      color: #d1d5db;
    }

    .controls {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      padding: 0.6rem;
      border-top: 1px solid var(--line);
    }

    button {
      background: var(--blue);
      color: white;
      border: 0;
      border-radius: 6px;
      padding: 0.45rem 0.75rem;
      cursor: pointer;
    }

    button:hover { filter: brightness(1.1); }

    .summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      padding: 0.75rem;
      font-size: 0.75rem;
      border-top: 1px solid var(--line);
    }

    .summary .tile {
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 0.6rem;
      background: var(--panel);
      text-align: center;
    }

    .summary .tile .n {
      font-family: var(--mono);
      font-size: 1.1rem;
      color: var(--green);
    }

    @keyframes fade {
      from { opacity: 0; transform: translateY(-6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
      .chain { border-left: none; border-right: none; border-top: 1px solid var(--line); border-bottom: 1px solid var(--line); }
    }
  </style>
</head>
<body>
  <header>
    <h2 style="margin:0">Zcash Agent Toolkit</h2>
    <div style="color: var(--muted); font-size: 0.85rem;">
      Protocol identity and task flow over Zcash shielded memos
    </div>
  </header>

  <div class="layout">
    <div class="panel agent-alpha" id="alpha">
      <div class="agent-header">Agent Alpha</div>
      <div class="agent-card">
        <div class="label">Agent ID (BLAKE3-derived)</div>
        <div class="value" id="alpha-id">waiting...</div>
      </div>
      <div class="agent-card">
        <div class="label">Capabilities</div>
        <div class="value" id="alpha-caps">task-assignment, command</div>
      </div>
      <div class="status" id="alpha-status">Idle</div>
      <div class="log" id="alpha-log"></div>
    </div>

    <div class="chain">
      <h3>Zcash shielded memo layer</h3>
      <div class="label" style="text-align:center;">All memos are 512 bytes, identity and payload encrypted by shielded memo layer.</div>
      <div id="chain-memos"></div>
      <div class="summary">
        <div class="tile">
          <div class="n" id="s-memos">0</div>
          <div>memos</div>
        </div>
        <div class="tile">
          <div class="n" id="s-chunks">0</div>
          <div>chunk bytes</div>
        </div>
        <div class="tile">
          <div class="n" id="s-learned">hidden</div>
          <div>observer learns</div>
        </div>
      </div>
      <div style="font-size: 0.65rem; color: var(--muted); text-align: center; padding-bottom: 0.2rem;">
        Privacy summary: Zcash encrypts everything. We handle the protocol.
      </div>
    </div>

    <div class="panel agent-beta" id="beta">
      <div class="agent-header">Agent Beta</div>
      <div class="agent-card">
        <div class="label">Agent ID (BLAKE3-derived)</div>
        <div class="value" id="beta-id">waiting...</div>
      </div>
      <div class="agent-card">
        <div class="label">Capabilities</div>
        <div class="value" id="beta-caps">task-execution, proof-submit</div>
      </div>
      <div class="status" id="beta-status">Idle</div>
      <div class="log" id="beta-log"></div>
    </div>
  </div>

  <div class="controls">
    <button id="run">Run full flow</button>
    <button id="cmd">Send custom command</button>
    <input id="cmd-text" value="Check transaction graph for private channels" style="width: 320px;" />
  </div>

  <script>
    const MEMO_SIZE = 512;
    const toHex = bytes => Array.from(bytes, b => b.toString(16).padStart(2, '0')).join('');
    const sleep = ms => new Promise(res => setTimeout(res, ms));

    const alphaStatus = document.getElementById('alpha-status');
    const betaStatus = document.getElementById('beta-status');
    const alphaId = document.getElementById('alpha-id');
    const betaId = document.getElementById('beta-id');
    const alphaLog = document.getElementById('alpha-log');
    const betaLog = document.getElementById('beta-log');
    const chain = document.getElementById('chain-memos');
    const statMemos = document.getElementById('s-memos');
    const statBytes = document.getElementById('s-chunks');
    const statLearned = document.getElementById('s-learned');

    let memoCount = 0;

    function log(panel, text) {
      const p = document.createElement('p');
      p.textContent = text;
      panel.appendChild(p);
      panel.scrollTop = panel.scrollHeight;
    }

    async function deriveId(label) {
      const bytes = new Uint8Array(32);
      crypto.getRandomValues(bytes);
      // Placeholder deterministic view for the demo: hex id from random bytes.
      // In real runtime this is BLAKE3-derived from seed/seed phrase.
      return toHex(bytes);
    }

    function addMemo(from, type, detail) {
      memoCount += 1;
      const card = document.createElement('div');
      card.className = 'memo';
      const colorClass = from === 'alpha' ? 'alpha' : 'beta';
      card.innerHTML = `
        <div class="kind ${colorClass}">${type}</div>
        <div class="from">From ${from === 'alpha' ? 'Agent Alpha' : 'Agent Beta'} · MEMO #${memoCount}</div>
        <div class="details">${detail}</div>
      `;
      chain.appendChild(card);
      chain.scrollTop = chain.scrollHeight;
      statMemos.textContent = memoCount.toString();
      statBytes.textContent = (memoCount * MEMO_SIZE).toString();
      statLearned.textContent = 'nothing';
    }

    function chunkText(text) {
      // simulate chunked payload with realistic 452-byte payload size.
      const payload = text;
      const maxPayload = 452;
      const chunks = Math.max(1, Math.ceil(payload.length / maxPayload));
      return chunks;
    }

    async function stepIdentity() {
      alphaStatus.textContent = 'Generating identities';
      betaStatus.textContent = 'Generating identities';
      const a = await deriveId('a');
      const b = await deriveId('b');
      alphaId.textContent = `${a.slice(0, 36)}...`;
      betaId.textContent = `${b.slice(0, 36)}...`;
      log(alphaLog, 'Agent Alpha ready with deterministic ID.');
      log(betaLog, 'Agent Beta ready with deterministic ID.');
      await sleep(500);
      alphaStatus.textContent = 'Ready';
      betaStatus.textContent = 'Ready';
    }

    async function stepHandshake() {
      alphaStatus.textContent = 'Sending identity handshake';
      log(alphaLog, 'Encoding Handshake: agent id + capabilities');
      addMemo('alpha', 'Handshake', 'Identity envelope: agent id + capabilities');
      await sleep(700);
      betaStatus.textContent = 'Receiving identity handshake';
      log(betaLog, `Handshake decoded -> accepted identity ${alphaId.textContent}`);
      await sleep(700);
      alphaStatus.textContent = 'Ready';
      betaStatus.textContent = 'Ready';
    }

    async function stepCommand() {
      alphaStatus.textContent = 'Encoding command';
      const cmd = 'Audit contract 0xABC for privacy leaks';
      addMemo('alpha', 'Command', `${cmd}`);
      const chunks = chunkText(cmd);
      if (chunks > 1) addMemo('alpha', 'Command', `Chunked command (${chunks} chunks)`);
      await sleep(700);
      betaStatus.textContent = 'Decoding command';
      log(betaLog, `Decoded command: ${cmd}`);
      alphaStatus.textContent = 'Command delivered';
      betaStatus.textContent = 'Ready';
    }

    async function stepWorkflow() {
      addMemo('alpha', 'TaskAssign', 'TaskAssign: Audit contract · reward 0.5 ZEC');
      log(alphaLog, 'TaskAssign emitted to Beta (through shielded memos)');
      await sleep(700);
      log(betaLog, 'Task assignment received and validated');
      addMemo('beta', 'TaskProof', 'TaskProof: completed. evidence: ipfs://Qm...');
      await sleep(700);
      log(alphaLog, 'Proof received, hash verified');
      addMemo('alpha', 'PaymentConfirm', 'PaymentConfirm: tx=abcd1234... amount 0.5 ZEC');
      await sleep(700);
      log(betaLog, 'Payment confirmation received.');
      alphaStatus.textContent = 'Task workflow complete';
      betaStatus.textContent = 'Task workflow complete';
    }

    async function runFlow() {
      chain.innerHTML = '';
      alphaLog.innerHTML = '';
      betaLog.innerHTML = '';
      memoCount = 0;
      statMemos.textContent = '0';
      statBytes.textContent = '0';
      statLearned.textContent = 'nothing';
      await stepIdentity();
      await stepHandshake();
      await stepCommand();
      await stepWorkflow();
      alphaStatus.textContent = 'Idle';
      betaStatus.textContent = 'Idle';
    }

    async function sendCustomCommand() {
      const input = document.getElementById('cmd-text');
      const text = input.value.trim();
      if (!text) return;
      alphaStatus.textContent = 'Sending command';
      addMemo('alpha', 'Command', text);
      await sleep(400);
      log(betaLog, `Decoded command: ${text}`);
      alphaStatus.textContent = 'Idle';
      betaStatus.textContent = 'Idle';
    }

    document.getElementById('run').addEventListener('click', () => runFlow());
    document.getElementById('cmd').addEventListener('click', () => sendCustomCommand());
    runFlow();
  </script>
</body>
</html>
